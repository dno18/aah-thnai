<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مؤسسة عبدالمنعم الراشد الإنسانية - تهنئة عيد الفطر</title>
  <style>
    /* الأساسيات */
    body {
      width: 100%;
      height: 100%;
      background-image: repeating-radial-gradient(#0a58b1ee 88%, #b49d3f 90%);
      background-size: 50px 50px;
      position: relative;
      font-family: "Montserrat", sans-serif;
    }
    /* الشعار */
    .logo-container {
      text-align: center;
      margin-bottom: 20px;
    }
    .logo-container img {
      max-width: 100%;
      height: auto;
      max-width: 210px;
    }
    /* صندوق الإدخال */
    .input-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 10px auto;
    }
    input[type="text"] {
      padding: 6px;
      width: 80%;
      max-width: 450px;
      margin: 60px 0;
      text-align: center;
      font-size: 1.6rem;
      border-radius: 10px;
    }
    /* حاوية القوالب */
    .templates {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 20px;
    }
    .template {
      cursor: pointer;
      flex: 1 1 300px;
      max-width: 300px;
    }
    .template img {
      border-radius: 15px;
      transition: transform 0.2s;
      width: 100%;
      height: auto;
    }
    .template img:hover {
      transform: scale(1.05);
    }
    /* معاينة التهنئة */
    .preview-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-top: 20px;
    }
    .preview-container img {
      border-radius: 10px;
      display: block;
      margin: auto;
      width: 100%;
      max-width: 590px;
      height: auto;
    }
    /* زر التحميل */
    .download-button-container {
      margin-top: 20px;
    }
    button {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 5px;
      background: #183153;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 1.2rem;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- الشعار -->
  <div class="logo-container">
    <img src="https://www.aahf.sa/public/storage/infos/February2021/NHIJ1Lp8i9G4xNqy7XNa.png" alt="شعار الموقع">
  </div>

  <!-- صندوق الإدخال -->
  <div class="input-container">
    <input type="text" id="name" placeholder="أدخل اسمك هنا" oninput="updatePreview()">
  </div>

  <!-- قوالب التهنئة -->
  <div class="templates">
    <div class="template" onclick="selectTemplate('q1', 'https://i.postimg.cc/hP2WGShv/q1p2.jpg', 587, 387)">
      <img src="https://i.postimg.cc/hP2WGShv/q1p2.jpg" alt="قالب 1">
    </div>
    <div class="template" onclick="selectTemplate('q2', 'https://i.postimg.cc/Wz9NfLGh/q2.jpg', 587, 387)">
      <img src="https://i.postimg.cc/Wz9NfLGh/q2.jpg" alt="قالب 2">
    </div>
    <div class="template" onclick="selectTemplate('q3', 'https://i.postimg.cc/Nj9FxrvW/q2p.png', 587, 387)">
      <img src="https://i.postimg.cc/Nj9FxrvW/q2p.png" alt="قالب 3">
    </div>
    <div class="template" onclick="selectTemplate('q4', 'https://i.postimg.cc/RhbdJCBf/q5.jpg', 300, 500)">
      <img src="https://i.postimg.cc/RhbdJCBf/q5.jpg" alt="قالب 4">
    </div>
    <div class="template" onclick="selectTemplate('q5', 'https://i.postimg.cc/PxKBXFt7/q7.jpg', 300, 500)">
      <img src="https://i.postimg.cc/PxKBXFt7/q7.jpg" alt="قالب 5">
    </div>
  </div>

  <!-- معاينة التهنئة وزر التحميل -->
  <div class="preview-container">
    <h2>معاينة التهنئة</h2>
    <img id="previewImage" src="" alt="معاينة القالب مع الاسم" style="display: none;">
    <div class="download-button-container">
      <button id="downloadButton" onclick="generateGreeting()">تحميل التهنئة</button>
    </div>
  </div>

  <canvas id="canvas" style="display:none;"></canvas>

  <script>
    let selectedTemplate = '';
    let selectedTemplateId = '';
    let previewWidth = 0;
    let previewHeight = 0;

    const textPositions = {
      q1: { x: 338, y: 359, color: 'white' },
      q2: { x: 335, y: 320, color: 'black' },
      q3: { x: 400, y: 344, color: 'black' },
      q4: { x: 145, y: 265, color: 'black' },
      q5: { x: 145, y: 290, color: 'black' },
      q6: { x: 180, y: 540, color: 'white' }
    };

    function selectTemplate(templateId, templateUrl, width, height) {
      selectedTemplate = templateUrl;
      selectedTemplateId = templateId;
      previewWidth = width;
      previewHeight = height;

      const previewImage = document.getElementById('previewImage');
      previewImage.style.width = '100%';
      previewImage.style.maxWidth = width + 'px';
      previewImage.style.height = 'auto';

      updatePreview();
    }

    function calculateFontSize(textLength) {
      return textLength <= 6 ? 20 : textLength <= 10 ? 18 : 16;
    }

    function updatePreview() {
      generateGreeting(false);
    }

    function generateGreeting(download = false) {
      const name = document.getElementById('name').value;
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      const previewImage = document.getElementById('previewImage');

      if (selectedTemplate && selectedTemplateId) {
        canvas.width = previewWidth;
        canvas.height = previewHeight;

        const img = new Image();
        img.crossOrigin = "anonymous";
        img.src = selectedTemplate;

        img.onload = function() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

          if (name) {
            let position = textPositions[selectedTemplateId];
            ctx.font = `${calculateFontSize(name.length)}px Arial`;
            ctx.fillStyle = position.color;
            ctx.textAlign = 'center';
            ctx.fillText(name, position.x, position.y);
          }

          previewImage.src = canvas.toDataURL('image/png');
          previewImage.style.display = 'block';

          if (download) {
            canvas.toBlob(blob => {
              const file = new File([blob], "greeting.png", { type: 'image/png' });
              if (navigator.canShare && navigator.canShare({ files: [file] })) {
                navigator.share({
                  files: [file],
                  title: 'تهنئة عيد الفطر',
                  text: 'إليك تهنئة عيد الفطر!'
                }).then(() => {
                  console.log('تمت المشاركة بنجاح');
                }).catch((error) => {
                  console.error('فشلت المشاركة:', error);
                });
              } else {
                alert("لا يمكن استخدام خاصية المشاركة في هذا المتصفح.");
              }
            }, 'image/png');
          }
        };
      } else {
        alert("يرجى اختيار قالب تهنئة أولاً!");
      }
    }
  </script>
</body>
</html>
