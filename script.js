// Language Management
const translations = {
    ar: {
        // Navigation
        "nav_home": "الرئيسية",
        "nav_about": "من نحن",
        "nav_about_fablab": "عن فاب لاب",
        "nav_paths": "مساراتنا",
        "nav_sections": "أقسامنا",
        "nav_facilities": "مرافقنا",
        "nav_services": "الخدمات",
        "nav_workshops": "الدورات",
        "nav_our_services": "خدماتنا",
        "nav_media": "المركز الإعلامي",
        "nav_success": "قصص النجاح",
        "nav_join": "انضم إلينا",
        "nav_volunteer": "التطوع",
        "nav_internship": "التدريب التعاوني",
        "nav_contact": "تواصل معنا",
        "nav_register": "تسجيل",
        "nav_login": "دخول",

        // Video Section
        "video_title": "مستقبل الإبداع يبدأ هنا",
        "video_subtitle": "اكتشف عالم التصنيع الرقمي مع فاب لاب الأحساء",

        // About Section
        "about_title": "عن فاب لاب الأحساء",
        "service_1": "الإبداع اللامحدود",
        "service_2": "التعليم المستمر",
        "service_3": "الشراكات العالمية",

        // Vision Section
        "vision_title": "الرسالة والرؤية",
        "vision_mission": "الرسالة",
        "vision_vision": "الرؤية",
        "mission_text": "نشر ثقافة الإبداع والاختراع ومساعدة المجتمع في تحويل أفكارهم إلى منتجات عبر أحدث تقنيات التصنيع الرقمي المتواجدة في الفاب لاب",
        "vision_text": "أن نكون أفضل مصنع رقمي متميز حول العالم يساهم في تنمية الإبداع والابتكار",

        // Workshops Section
        "workshops_title": "ورش العمل والبرامج",
        "workshop_1_title": "التصنيع الرقمي",
        "workshop_1_desc": "تعلم أساسيات التصنيع الرقمي واستخدام الطابعات ثلاثية الأبعاد",
        "workshop_1_duration": "مدة: 3 أيام تدريبية مكثفة",
        "workshop_2_title": "الإلكترونيات",
        "workshop_2_desc": "تطوير المشاريع الإلكترونية باستخدام Arduino وRaspberry Pi",
        "workshop_2_duration": "مدة: 5 أيام تدريبية شاملة",
        "workshop_3_title": "البرمجة",
        "workshop_3_desc": "تعلم لغات البرمجة المختلفة وتطوير التطبيقات",
        "workshop_3_duration": "مدة: 7 أيام تدريبية عملية",
        "workshop_4_title": "التصميم الجرافيكي",
        "workshop_4_desc": "إتقان برامج التصميم وإنشاء المحتوى البصري",
        "workshop_4_duration": "مدة: 4 أيام تدريبية مكثفة",
        "workshop_5_title": "الذكاء الاصطناعي",
        "workshop_5_desc": "مقدمة في تقنيات الذكاء الاصطناعي وتطبيقاتها",
        "workshop_5_duration": "مدة: 6 أيام تدريبية شاملة",
        "workshop_6_title": "ريادة الأعمال",
        "workshop_6_desc": "تطوير الأفكار التجارية وبناء المشاريع الناشئة",
        "workshop_6_duration": "مدة: 5 أيام تدريبية عملية",

        // Achievements Section
        "achievements_title": "إنجازاتنا بالأرقام",
        "achievements_text": "نفخر بما حققناه من إنجازات وما قدمناه لمجتمعنا",
        "achievement_1": "المستفيدين",
        "achievement_2": "المشاريع المنجزة",
        "achievement_3": "ورش العمل",

        // Partners Section
        "partners_title": "شركاؤنا",
        "partners_text": "نحن فخورون بشراكاتنا مع المؤسسات والأفراد الذين يدعمون رؤيتنا",

        // Footer
        "programmers_title": "المبرمجون",
        "programmer_1": "باسم المشموم",
        "programmer_2": "علي العبودي",
        "map_title": "موقعنا على الخريطة",
        "contact_title": "معلومات الاتصال",
        "contact_email": "البريد الإلكتروني: info@fablabahsa.org",
        "contact_phone": "الهاتف: 40004-58-013",
        "contact_address": "العنوان: الأحساء - حي الحزام الذهبي - شارع عين نجم",
        "contact_form_title": "أرسل لنا رسالة",
        "form_name": "اسمك الكامل",
        "form_email": "بريدك الإلكتروني",
        "form_message": "رسالتك هنا...",
        "form_submit": "إرسال الرسالة",
        "copyright": "© 2025 فاب لاب الأحساء - مبادرة مؤسسة عبد المنعم الراشد الإنسانية",

        // Chatbot
        "chatbot_title": "دردشة فاب لاب الأحساء - مدعومة بالذكاء الاصطناعي",
        "chatbot_welcome": "مرحبًا , أنا مساعد فاب لاب الأحساء . كيف يمكنني مساعدتك اليوم ؟",
        "chatbot_placeholder": "اكتب سؤالك هنا...",
        "chatbot_send": "إرسال"
    },
    en: {
        // Navigation
        "nav_home": "Home",
        "nav_about": "About Us",
        "nav_about_fablab": "About Fab Lab",
        "nav_paths": "Our Paths",
        "nav_sections": "Our Sections",
        "nav_facilities": "Our Facilities",
        "nav_services": "Services",
        "nav_workshops": "Workshops",
        "nav_our_services": "Our Services",
        "nav_media": "Media Center",
        "nav_success": "Success Stories",
        "nav_join": "Join Us",
        "nav_volunteer": "Volunteer",
        "nav_internship": "Cooperative Training",
        "nav_contact": "Contact Us",
        "nav_register": "Register",
        "nav_login": "Login",

        // Video Section
        "video_title": "The Future of Creativity Starts Here",
        "video_subtitle": "Discover the world of digital manufacturing with Fab Lab Al Ahsa",

        // About Section
        "about_title": "About Fab Lab Al Ahsa",
        "service_1": "Unlimited Creativity",
        "service_2": "Continuous Education",
        "service_3": "Global Partnerships",

        // Vision Section
        "vision_title": "Mission & Vision",
        "vision_mission": "Mission",
        "vision_vision": "Vision",
        "mission_text": "Spreading the culture of creativity and invention, helping the community transform their ideas into products through the latest digital manufacturing technologies available at Fab Lab",
        "vision_text": "To be the world's leading distinguished digital factory that contributes to the development of creativity and innovation",

        // Workshops Section
        "workshops_title": "Workshops & Programs",
        "workshop_1_title": "Digital Manufacturing",
        "workshop_1_desc": "Learn the basics of digital manufacturing and using 3D printers",
        "workshop_1_duration": "Duration: 3 intensive training days",
        "workshop_2_title": "Electronics",
        "workshop_2_desc": "Developing electronic projects using Arduino and Raspberry Pi",
        "workshop_2_duration": "Duration: 5 comprehensive training days",
        "workshop_3_title": "Programming",
        "workshop_3_desc": "Learn different programming languages and develop applications",
        "workshop_3_duration": "Duration: 7 practical training days",
        "workshop_4_title": "Graphic Design",
        "workshop_4_desc": "Master design software and create visual content",
        "workshop_4_duration": "Duration: 4 intensive training days",
        "workshop_5_title": "Artificial Intelligence",
        "workshop_5_desc": "Introduction to AI technologies and their applications",
        "workshop_5_duration": "Duration: 6 comprehensive training days",
        "workshop_6_title": "Entrepreneurship",
        "workshop_6_desc": "Developing business ideas and building startups",
        "workshop_6_duration": "Duration: 5 practical training days",

        // Achievements Section
        "achievements_title": "Our Achievements in Numbers",
        "achievements_text": "We are proud of what we have achieved and what we have provided to our community",
        "achievement_1": "Beneficiaries",
        "achievement_2": "Completed Projects",
        "achievement_3": "Workshops",

        // Partners Section
        "partners_title": "Our Partners",
        "partners_text": "We are proud of our partnerships with institutions and individuals who support our vision",

        // Footer
        "programmers_title": "Programmers",
        "programmer_1": "Basem Al Mashmoum",
        "programmer_2": "Ali Al Aboudi",
        "map_title": "Our Location on Map",
        "contact_title": "Contact Information",
        "contact_email": "Email: info@fablabahsa.org",
        "contact_phone": "Phone: 013-58-40004",
        "contact_address": "Address: Al Ahsa - Al Hezam Al Thahabi District - Ain Najm Street",
        "contact_form_title": "Send us a message",
        "form_name": "Your full name",
        "form_email": "Your email",
        "form_message": "Your message here...",
        "form_submit": "Send Message",
        "copyright": "© 2025 Fab Lab Al Ahsa - An initiative of Abdulmunem Al Rashed Humanitarian Foundation",

        // Chatbot
        "chatbot_title": "Fab Lab Al Ahsa Chat - Powered by AI",
        "chatbot_welcome": "Hello, I'm Fab Lab Al Ahsa assistant. How can I help you today?",
        "chatbot_placeholder": "Type your question here...",
        "chatbot_send": "Send"
    }
};

// Language Management Functions
let currentLanguage = 'ar';

function switchLanguage(lang) {
    currentLanguage = lang;
    
    // Update HTML direction and lang attribute
    const htmlElement = document.getElementById('htmlElement');
    htmlElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    htmlElement.lang = lang;
    
    // Update all translatable elements
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });
    
    // Update placeholder texts
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[lang][key]) {
            element.placeholder = translations[lang][key];
        }
    });
    
    // Update language switch button text
    const languageSwitch = document.getElementById('languageSwitch');
    if (languageSwitch) {
        languageSwitch.textContent = lang === 'ar' ? 'EN' : 'AR';
    }
    
    // Update typing text
    updateTypingText(lang);
    
    // Save language preference
    localStorage.setItem('preferredLanguage', lang);
}

function updateTypingText(lang) {
    const typingText = document.querySelector('.typing-text');
    if (!typingText) return;
    
    const text = lang === 'ar' 
        ? "فاب لاب الأحساء هو مساحة إبداعية مجهزة بأحدث تقنيات التصنيع الرقمي، حيث نوفر للطلاب والمخترعين ورواد الأعمال الأدوات والموارد اللازمة لتحويل أفكارهم إلى واقع ملموس. نحن نؤمن بقوة الإبداع وقدرته على تغيير العالم، ونسعى لتمكين المجتمع من خلال التكنولوجيا والتعليم."
        : "Fab Lab Al Ahsa is a creative space equipped with the latest digital manufacturing technologies, where we provide students, inventors, and entrepreneurs with the tools and resources needed to turn their ideas into tangible reality. We believe in the power of creativity and its ability to change the world, and we strive to empower the community through technology and education.";
    
    typingText.innerHTML = text + '<span class="typing-cursor"></span>';
}

// Mobile Menu Functionality
document.addEventListener('DOMContentLoaded', function() {
    // Mobile menu elements
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const mobileMenuClose = document.getElementById('mobileMenuClose');
    const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
    const mainNav = document.getElementById('mainNav');
    
    // Toggle mobile menu
    function toggleMobileMenu() {
        mainNav.classList.toggle('active');
        mobileMenuOverlay.classList.toggle('active');
        document.body.style.overflow = mainNav.classList.contains('active') ? 'hidden' : '';
    }
    
    // Event listeners for mobile menu
    if (mobileMenuToggle) {
        mobileMenuToggle.addEventListener('click', toggleMobileMenu);
    }
    
    if (mobileMenuClose) {
        mobileMenuClose.addEventListener('click', toggleMobileMenu);
    }
    
    if (mobileMenuOverlay) {
        mobileMenuOverlay.addEventListener('click', toggleMobileMenu);
    }
    
    // Close mobile menu when clicking on nav links
    const navLinks = document.querySelectorAll('.nav a');
    navLinks.forEach(link => {
        link.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
                toggleMobileMenu();
            }
        });
    });
    
    // Handle dropdown menus on mobile
    const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
    dropdownToggles.forEach(toggle => {
        toggle.addEventListener('click', function(e) {
            if (window.innerWidth <= 768) {
                e.preventDefault();
                const dropdown = this.parentElement;
                dropdown.classList.toggle('active');
                
                // Close other dropdowns
                dropdownToggles.forEach(otherToggle => {
                    if (otherToggle !== this) {
                        otherToggle.parentElement.classList.remove('active');
                    }
                });
            }
        });
    });
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
        if (window.innerWidth <= 768) {
            if (!e.target.closest('.dropdown')) {
                dropdownToggles.forEach(toggle => {
                    toggle.parentElement.classList.remove('active');
                });
            }
        }
    });
    
    // Language Switch
    const languageSwitch = document.getElementById('languageSwitch');
    if (languageSwitch) {
        languageSwitch.addEventListener('click', function(e) {
            e.preventDefault();
            const newLang = currentLanguage === 'ar' ? 'en' : 'ar';
            switchLanguage(newLang);
        });
    }
    
    // Load saved language preference
    const savedLanguage = localStorage.getItem('preferredLanguage') || 'ar';
    switchLanguage(savedLanguage);
    
    // Star Background Animation
    function initStarBackground() {
        const canvas = document.getElementById('star-canvas');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        const stars = [];
        const starCount = 200;
        
        for (let i = 0; i < starCount; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 1.5,
                speed: Math.random() * 0.5,
                opacity: Math.random()
            });
        }
        
        function animateStars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0a0f1d';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            stars.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                ctx.fill();
                
                star.y += star.speed;
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width;
                }
            });
            
            requestAnimationFrame(animateStars);
        }
        
        animateStars();
    }
    
    // Enhanced Star Background
    function initEnhancedStarBackground() {
        const canvas = document.getElementById('enhancedStarCanvas');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        const stars = [];
        const starCount = 300;
        
        for (let i = 0; i < starCount; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 2,
                speed: Math.random() * 0.8,
                opacity: Math.random() * 0.8 + 0.2,
                twinkleSpeed: Math.random() * 0.05
            });
        }
        
        function animateEnhancedStars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            stars.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                ctx.fill();
                
                // Twinkle effect
                star.opacity += star.twinkleSpeed;
                if (star.opacity > 1 || star.opacity < 0.2) {
                    star.twinkleSpeed = -star.twinkleSpeed;
                }
                
                star.y += star.speed;
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width;
                }
            });
            
            requestAnimationFrame(animateEnhancedStars);
        }
        
        animateEnhancedStars();
    }
    
    // Section Star Backgrounds
    function initSectionStars() {
        const sections = document.querySelectorAll('.section-stars');
        
        sections.forEach((canvas, index) => {
            const ctx = canvas.getContext('2d');
            
            function resizeCanvas() {
                const section = canvas.closest('.section');
                if (section) {
                    canvas.width = section.offsetWidth;
                    canvas.height = section.offsetHeight;
                }
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            const stars = [];
            const starCount = 50;
            
            for (let i = 0; i < starCount; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 1.2,
                    speed: Math.random() * 0.3,
                    opacity: Math.random() * 0.6 + 0.2
                });
            }
            
            function animateSectionStars() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                stars.forEach(star => {
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                    ctx.fill();
                    
                    star.y += star.speed;
                    if (star.y > canvas.height) {
                        star.y = 0;
                        star.x = Math.random() * canvas.width;
                    }
                });
                
                requestAnimationFrame(animateSectionStars);
            }
            
            animateSectionStars();
        });
    }
    
    // Typing Animation
    function initTypingAnimation() {
        const typingText = document.querySelector('.typing-text');
        if (!typingText) return;
        
        let index = 0;
        const speed = 50;
        
        function typeWriter() {
            const text = currentLanguage === 'ar' 
                ? "فاب لاب الأحساء هو مساحة إبداعية مجهزة بأحدث تقنيات التصنيع الرقمي، حيث نوفر للطلاب والمخترعين ورواد الأعمال الأدوات والموارد اللازمة لتحويل أفكارهم إلى واقع ملموس. نحن نؤمن بقوة الإبداع وقدرته على تغيير العالم، ونسعى لتمكين المجتمع من خلال التكنولوجيا والتعليم."
                : "Fab Lab Al Ahsa is a creative space equipped with the latest digital manufacturing technologies, where we provide students, inventors, and entrepreneurs with the tools and resources needed to turn their ideas into tangible reality. We believe in the power of creativity and its ability to change the world, and we strive to empower the community through technology and education.";
            
            if (index < text.length) {
                typingText.innerHTML = text.substring(0, index + 1) + '<span class="typing-cursor"></span>';
                index++;
                setTimeout(typeWriter, speed);
            } else {
                typingText.innerHTML = text + '<span class="typing-cursor"></span>';
            }
        }
        
        // Start typing animation when element is in viewport
        function checkScroll() {
            const elementTop = typingText.getBoundingClientRect().top;
            const elementVisible = 150;
            
            if (elementTop < window.innerHeight - elementVisible) {
                typeWriter();
                window.removeEventListener('scroll', checkScroll);
            }
        }
        
        window.addEventListener('scroll', checkScroll);
        checkScroll(); // Check on page load
    }
    
    // Counter Animation
    function initCounterAnimation() {
        const counters = document.querySelectorAll('.counter');
        const speed = 200;
        
        function animateCounter(counter) {
            const target = +counter.getAttribute('data-target');
            const count = +counter.innerText;
            const increment = target / speed;
            
            if (count < target) {
                counter.innerText = Math.ceil(count + increment);
                setTimeout(() => animateCounter(counter), 1);
            } else {
                counter.innerText = target + '+';
            }
        }
        
        function checkScroll() {
            counters.forEach(counter => {
                const elementTop = counter.getBoundingClientRect().top;
                const elementVisible = 150;
                
                if (elementTop < window.innerHeight - elementVisible && !counter.classList.contains('animated')) {
                    counter.classList.add('animated');
                    animateCounter(counter);
                }
            });
        }
        
        window.addEventListener('scroll', checkScroll);
        checkScroll(); // Check on page load
    }
    
    // Workshops Carousel - FIXED VERSION
    function initWorkshopsCarousel() {
        const carousel = document.querySelector('.workshops-carousel');
        const prevBtn = document.querySelector('.prev-btn');
        const nextBtn = document.querySelector('.next-btn');
        const indicators = document.querySelectorAll('.indicator');
        
        if (!carousel) return;
        
        let currentIndex = 0;
        const items = document.querySelectorAll('.workshop-item');
        const itemCount = items.length;
        
        function updateCarousel() {
            // Calculate scroll position based on current index
            const scrollPosition = currentIndex * carousel.offsetWidth;
            
            carousel.scrollTo({
                left: scrollPosition,
                behavior: 'smooth'
            });
            
            // Update indicators
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentIndex);
            });
        }
        
        // Button events - FIXED
        if (prevBtn) {
            prevBtn.addEventListener('click', () => {
                currentIndex = Math.max(currentIndex - 1, 0);
                updateCarousel();
            });
        }
        
        if (nextBtn) {
            nextBtn.addEventListener('click', () => {
                currentIndex = Math.min(currentIndex + 1, itemCount - 1);
                updateCarousel();
            });
        }
        
        // Indicator events
        indicators.forEach((indicator, index) => {
            indicator.addEventListener('click', () => {
                currentIndex = index;
                updateCarousel();
            });
        });
        
        // Touch events for mobile
        let startX = 0;
        let endX = 0;
        
        carousel.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
        });
        
        carousel.addEventListener('touchend', (e) => {
            endX = e.changedTouches[0].clientX;
            handleSwipe();
        });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            
            if (startX - endX > swipeThreshold) {
                // Swipe left - next
                currentIndex = Math.min(currentIndex + 1, itemCount - 1);
                updateCarousel();
            } else if (endX - startX > swipeThreshold) {
                // Swipe right - previous
                currentIndex = Math.max(currentIndex - 1, 0);
                updateCarousel();
            }
        }
        
        // Auto-play for carousel (optional)
        let autoPlayInterval;
        
        function startAutoPlay() {
            autoPlayInterval = setInterval(() => {
                currentIndex = (currentIndex + 1) % itemCount;
                updateCarousel();
            }, 5000);
        }
        
        function stopAutoPlay() {
            clearInterval(autoPlayInterval);
        }
        
        // Start auto-play on desktop only
        if (window.innerWidth > 768) {
            startAutoPlay();
            
            // Pause auto-play on hover
            carousel.addEventListener('mouseenter', stopAutoPlay);
            carousel.addEventListener('mouseleave', startAutoPlay);
        }
        
        // Handle window resize
        window.addEventListener('resize', updateCarousel);
    }
    
    // Chatbot Functionality
    function initChatbot() {
        const chatbotToggle = document.querySelector('.chatbot-toggle');
        const chatbotContainer = document.querySelector('.chatbot-container');
        const chatbotClose = document.querySelector('.chatbot-close');
        const chatbotSend = document.getElementById('chatbot-send');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotMessages = document.getElementById('chatbot-messages');
        
        if (!chatbotToggle) return;
        
        // Toggle chatbot
        chatbotToggle.addEventListener('click', () => {
            chatbotContainer.classList.toggle('active');
        });
        
        // Close chatbot
        if (chatbotClose) {
            chatbotClose.addEventListener('click', () => {
                chatbotContainer.classList.remove('active');
            });
        }
        
        // Send message
        function sendMessage() {
            const message = chatbotInput.value.trim();
            if (message === '') return;
            
            // Add user message
            addMessage(message, 'user');
            chatbotInput.value = '';
            
            // Simulate bot response
            setTimeout(() => {
                const responses = currentLanguage === 'ar' ? [
                    "شكرًا لسؤالك! كيف يمكنني مساعدتك بشكل أفضل؟",
                    "هذا سؤال رائع! هل يمكنك تقديم المزيد من التفاصيل؟",
                    "أنا هنا لمساعدتك في أي استفسار حول فاب لاب الأحساء.",
                    "هل تريد معرفة المزيد عن ورش العمل أو الخدمات المتاحة؟",
                    "يمكنني مساعدتك في التسجيل أو تقديم معلومات عن البرامج."
                ] : [
                    "Thank you for your question! How can I help you better?",
                    "That's a great question! Can you provide more details?",
                    "I'm here to help you with any inquiry about Fab Lab Al Ahsa.",
                    "Would you like to know more about workshops or available services?",
                    "I can help you with registration or provide information about programs."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessage(randomResponse, 'bot');
            }, 1000);
        }
        
        // Add message to chat
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chatbot-message', sender);
            messageDiv.textContent = text;
            chatbotMessages.appendChild(messageDiv);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }
        
        // Send message events
        if (chatbotSend) {
            chatbotSend.addEventListener('click', sendMessage);
        }
        
        if (chatbotInput) {
            chatbotInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }
    }
    
    // Sticky Header
    function initStickyHeader() {
        const header = document.querySelector('.header');
        if (!header) return;
        
        const headerHeight = header.offsetHeight;
        
        function updateStickyHeader() {
            if (window.scrollY > headerHeight) {
                header.classList.add('sticky');
            } else {
                header.classList.remove('sticky');
            }
        }
        
        window.addEventListener('scroll', updateStickyHeader);
        updateStickyHeader(); // Check on page load
    }
    
    // Smooth Scrolling
    function initSmoothScrolling() {
        const links = document.querySelectorAll('a[href^="#"]');
        
        links.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    const offsetTop = targetElement.offsetTop - 80; // Adjust for header height
                    
                    window.scrollTo({
                        top: offsetTop,
                        behavior: 'smooth'
                    });
                }
            });
        });
    }
    
    // Contact Form Handling
    function initContactForm() {
        const contactForm = document.getElementById('contactForm');
        
        if (contactForm) {
            contactForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Simple form validation
                const name = this.querySelector('#footer-name').value;
                const email = this.querySelector('#footer-email').value;
                const message = this.querySelector('#footer-message').value;
                
                if (name && email && message) {
                    // Simulate form submission
                    const successMessage = currentLanguage === 'ar' 
                        ? 'شكرًا لتواصلك معنا! سنرد عليك في أقرب وقت ممكن.'
                        : 'Thank you for contacting us! We will get back to you as soon as possible.';
                    alert(successMessage);
                    this.reset();
                } else {
                    const errorMessage = currentLanguage === 'ar'
                        ? 'يرجى ملء جميع الحقول المطلوبة.'
                        : 'Please fill in all required fields.';
                    alert(errorMessage);
                }
            });
        }
    }
    
    // Initialize all functions
    function init() {
        initStarBackground();
        initEnhancedStarBackground();
        initSectionStars();
        initTypingAnimation();
        initCounterAnimation();
        initWorkshopsCarousel();
        initChatbot();
        initStickyHeader();
        initSmoothScrolling();
        initContactForm();
        
        // Handle resize events
        window.addEventListener('resize', function() {
            // Reinitialize carousel on resize
            initWorkshopsCarousel();
        });
    }
    
    // Start initialization when DOM is loaded
    init();
});

// Handle page load and transition
window.addEventListener('load', function() {
    document.body.classList.add('loaded');
    
    // Remove loading animation if any
    const loading = document.querySelector('.loading');
    if (loading) {
        setTimeout(() => {
            loading.style.display = 'none';
        }, 500);
    }
});
