<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تهنئة عيد الفطر</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #0a58b1, #b49d3f);
            padding: 20px;
            text-align: center;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
        }
        
        .logo {
            max-width: 200px;
            margin: 0 auto 20px;
        }
        
        input {
            padding: 12px;
            width: 80%;
            margin: 20px 0;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
        }
        
        .templates {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .template {
            width: 150px;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .template:hover {
            transform: scale(1.05);
            border-color: #b49d3f;
        }
        
        .template img {
            width: 100%;
            border-radius: 6px;
        }
        
        .preview {
            margin: 20px auto;
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            display: none;
        }
        
        .buttons {
            margin: 25px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        button {
            padding: 12px 25px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 200px;
            transition: all 0.3s;
        }
        
        .download-btn {
            background: #183153;
            color: white;
        }
        
        .save-btn {
            background: #b49d3f;
            color: white;
            display: none;
        }
        
        .instructions {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px auto;
            max-width: 90%;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://www.aahf.sa/public/storage/infos/February2021/NHIJ1Lp8i9G4xNqy7XNa.png" alt="شعار المؤسسة" class="logo">
        
        <input type="text" id="nameInput" placeholder="أدخل اسمك هنا">
        
        <div class="templates">
            <div class="template" data-template="1">
                <img src="https://i.postimg.cc/hP2WGShv/q1p2.jpg" alt="قالب 1">
            </div>
            <div class="template" data-template="2">
                <img src="https://i.postimg.cc/Wz9NfLGh/q2.jpg" alt="قالب 2">
            </div>
            <div class="template" data-template="3">
                <img src="https://i.postimg.cc/Nj9FxrvW/q2p.png" alt="قالب 3">
            </div>
            <div class="template" data-template="4">
                <img src="https://i.postimg.cc/RhbdJCBf/q5.jpg" alt="قالب 4">
            </div>
            <div class="template" data-template="5">
                <img src="https://i.postimg.cc/PxKBXFt7/q7.jpg" alt="قالب 5">
            </div>
        </div>
        
        <img id="previewImage" class="preview" alt="معاينة التهنئة">
        
        <div class="instructions" id="iosInstructions">
            <h3>طريقة الحفظ على الآيفون:</h3>
            <p>1. اضغط مطولاً على الصورة أعلاه</p>
            <p>2. اختر "حفظ الصورة" من القائمة</p>
        </div>
        
        <div class="buttons">
            <button class="download-btn" id="downloadBtn">تحميل التهنئة</button>
            <button class="save-btn" id="saveBtn">حفظ في الألبوم</button>
        </div>
    </div>

    <canvas id="canvas" style="display:none;"></canvas>

    <script>
        // بيانات القوالب
        const templates = {
            1: { src: "https://i.postimg.cc/hP2WGShv/q1p2.jpg", textX: 338, textY: 359, color: "white" },
            2: { src: "https://i.postimg.cc/Wz9NfLGh/q2.jpg", textX: 335, textY: 320, color: "black" },
            3: { src: "https://i.postimg.cc/Nj9FxrvW/q2p.png", textX: 400, textY: 344, color: "black" },
            4: { src: "https://i.postimg.cc/RhbdJCBf/q5.jpg", textX: 145, textY: 265, color: "black" },
            5: { src: "https://i.postimg.cc/PxKBXFt7/q7.jpg", textX: 145, textY: 290, color: "black" }
        };

        // العناصر
        const nameInput = document.getElementById("nameInput");
        const previewImage = document.getElementById("previewImage");
        const downloadBtn = document.getElementById("downloadBtn");
        const saveBtn = document.getElementById("saveBtn");
        const iosInstructions = document.getElementById("iosInstructions");
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        // المتغيرات
        let selectedTemplate = null;

        // اختيار القالب
        document.querySelectorAll(".template").forEach(template => {
            template.addEventListener("click", () => {
                selectedTemplate = templates[template.dataset.template];
                updatePreview();
            });
        });

        // تحديث المعاينة
        function updatePreview() {
            const name = nameInput.value.trim();
            if (!selectedTemplate || !name) return;

            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.src = selectedTemplate.src;
            
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                
                ctx.drawImage(img, 0, 0);
                
                // إضافة النص
                ctx.font = `20px Arial`;
                ctx.fillStyle = selectedTemplate.color;
                ctx.textAlign = "center";
                ctx.fillText(name, selectedTemplate.textX, selectedTemplate.textY);
                
                // عرض المعاينة
                previewImage.src = canvas.toDataURL("image/png");
                previewImage.style.display = "block";
                
                // إظهار الأزرار المناسبة
                if (isIOS()) {
                    saveBtn.style.display = "block";
                    iosInstructions.style.display = "block";
                }
            };
        }

        // تحميل الصورة
        downloadBtn.addEventListener("click", () => {
            if (!selectedTemplate) {
                alert("الرجاء اختيار قالب أولاً");
                return;
            }
            
            const name = nameInput.value.trim();
            if (!name) {
                alert("الرجاء إدخال اسمك أولاً");
                return;
            }
            
            const link = document.createElement("a");
            link.download = `تهنئة-عيد-الفطر-${name}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        });

        // حفظ الصورة (لـ iOS)
        saveBtn.addEventListener("click", () => {
            alert("الرجاء الضغط مطولاً على الصورة ثم اختيار 'حفظ الصورة'");
        });

        // كشف جهاز iOS
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent);
        }

        // تحديث عند كتابة الاسم
        nameInput.addEventListener("input", updatePreview);
    </script>
</body>
</html>
